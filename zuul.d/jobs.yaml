- job:
    name: airship-image-builder-upload-git-mirror
    parent: upload-git-mirror
    description: Mirrors airship/image-builder to airshipit/image-builder
    vars:
      git_mirror_repository: airshipit/image-builder
    secrets:
      - name: git_mirror_credentials
        secret: airship_image_builder_airshipit_github_key
        pass-to-parent: true

- job:
    name: airship-image-builder-build
    nodeset: airship-image-builder-single-node
    timeout: 7200
    post-timeout: 7200
    pre-run: playbooks/airship-image-builder-deploy-docker.yaml
    run: playbooks/airship-image-builder-build.yaml
    post-run: playbooks/airship-image-builder-collect-logs.yaml

- job:
    name: airship-image-builder-publish-latest
    nodeset: airship-image-builder-single-node
    timeout: 7200
    post-timeout: 7200
    pre-run: playbooks/airship-image-builder-deploy-docker.yaml
    run: playbooks/airship-image-builder-publish-latest.yaml
    secrets:
      - name: image_builder_quay_creds
        secret: image_builder_quay_creds

- job:
    name: airship-image-builder-publish-commit
    parent: airship-image-builder-publish-latest
    vars:
      image_tag: "{{ zuul.newrev }}"

- nodeset:
    name: airship-image-builder-single-node
    nodes:
      - name: primary
        label: ubuntu-bionic-32GB
